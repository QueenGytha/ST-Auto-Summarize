
> sillytavern@1.13.5 postinstall
> node post-install.js

Synchronized missing files: ./public/

up to date in 1s
Node version: v20.19.4. Running in production environment. Server directory: C:\Users\sarah\OneDrive\Desktop\personal\SillyTavern-New
Using config path: ./config.yaml
Using data root: ./data
Preferring IPv4 for DNS resolution

SillyTavern 1.13.5
Running 'release' (e9cd32a12) - 10/23/2025, 10:35:15 PM GMT+13


Compiling frontend libraries...
webpack 5.98.0 compiled successfully in 280 ms

Launching in a browser: default...
SillyTavern is listening on IPv4: 127.0.0.1:8000

=================================================

Go to: http://127.0.0.1:8000/ to open SillyTavern

=================================================

Extensions available for default-user [
  { type: 'system', name: 'assets' },
  { type: 'system', name: 'attachments' },
  { type: 'system', name: 'caption' },
  { type: 'system', name: 'connection-manager' },
  { type: 'system', name: 'expressions' },
  { type: 'system', name: 'gallery' },
  { type: 'system', name: 'memory' },
  { type: 'system', name: 'quick-reply' },
  { type: 'system', name: 'regex' },
  { type: 'system', name: 'stable-diffusion' },
  { type: 'system', name: 'token-counter' },
  { type: 'system', name: 'translate' },
  { type: 'system', name: 'tts' },
  { type: 'system', name: 'vectors' },
  { type: 'global', name: 'third-party/ST-Auto-Summarize' }
]
Available models: [
  'chatgpt-4o-latest',
  'claude-3-5-sonnet-20241022',
  'claude-3-7-sonnet-20250219',
  'claude-3-opus-20240229',
  'claude-opus-4-20250514',
  'claude-opus-5-20251012',
  'claude-opus-6-20260214',
  'claude-sonnet-4-20250514',
  'claude-sonnet-4-5-20250929',
  'deepseek-r1',
  'deepseek-v3',
  'gemini-2.5-pro',
  'gpt-4-1106-preview',
  'gpt-4.1',
  'gpt-5-2025-08-07'
]
Instantiated the tokenizer for claude
Chat Completion request: {
  messages: [
    { role: 'system', content: 'Complete the requested task.' },
    {
      role: 'user',
      content: '// OOC REQUEST: Pause the roleplay and step out of character for this reply.\n' +
        '// Extract key information from the completed scene below into a structured JSON format.\n' +
        '// This separates timeline narrative from detailed reference information.\n' +
        '//\n' +
        '// ⚠️ CRITICAL: ONLY USE TEXT BELOW - NO OUTSIDE KNOWLEDGE ⚠️\n' +
        '//\n' +
        '// - ONLY extract information explicitly written in the scene text below\n' +
        '// - DO NOT use ANY information from your training data\n' +
        '// - If a name matches a franchise character, IGNORE franchise details completely\n' +
        '// - If something is not mentioned in the text below, it DOES NOT EXIST\n' +
        '// - Incomplete information is CORRECT - do not fill gaps\n' +
        '// - When in doubt, OMIT the detail entirely\n' +
        '//\n' +
        '// CRITICAL: SEPARATION OF CONCERNS\n' +
        '//\n' +
        '// SUMMARY field:\n' +
        '// - Brief chronological thread of scene outcomes (what happened, how it ended)\n' +
        '// - Capture CURRENT STATE after scene concludes\n' +
        "// - MENTION entities by name but DON'T describe them (descriptions go in lorebooks)\n" +
        '// - Focus on STATE CHANGES and OUTCOMES, not step-by-step processes\n' +
        '// - Terse, factual, past tense\n' +
        '// - Target: 200-500 tokens (scenes are longer than messages)\n' +
        '//\n' +
        '// LOREBOOKS array:\n' +
        '// - NEW entities discovered OR UPDATES to existing entities\n' +
        '// - MUST use PList (Property List) format for content (28-44% token savings)\n' +
        '// - Each entry needs: name, type, keywords, content\n' +
        '// - Type must be one of: character|location|item|faction|quest|rule\n' +
        '// - Optional: secondaryKeys (array) for AND disambiguation\n' +
        '// - Only significant entities worth remembering\n' +
        '//\n' +
        '// PList FORMAT (REQUIRED):\n' +
        '// Syntax: [EntityName: property1, property2, nested(detail1, detail2)]\n' +
        '// - Use square brackets [ ] around entire entry\n' +
        '// - Colon after entity name\n' +
        '// - Comma-separated properties\n' +
        '// - Nested details use parentheses ( )\n' +
        '// - Max 2 levels of nesting for AI parsing\n' +
        '// - Strong associations: [Entity(primary descriptor): other properties]\n' +
        '//\n' +
        '// PList Examples:\n' +
        '// [Shadow Guild: secret organization, opposes(corrupt nobility), member(Bob), has(intelligence network), operations(covert)]\n' +
        '// [Alice: warrior, appearance(red hair, green eyes, late 20s), personality(confident, direct), searching for(Sunblade)]\n' +
        '// [Eastern Ruins: ancient temple, location(mountainside), status(ransacked), significance(sacred site)]\n' +
        '//\n' +
        '// SCENE-SPECIFIC GUIDELINES:\n' +
        '//\n' +
        '// 1. ROLEPLAY RELEVANCE\n' +
        "//    - Include what's needed to continue roleplay coherently\n" +
        '//    - Character development and relationship changes\n' +
        '//    - Plot-critical information\n' +
        '//    - Setting details and atmosphere\n' +
        '//    - Current status and pending decisions\n' +
        '//\n' +
        '// 2. FOCUS ON STATE, NOT EVENT SEQUENCES\n' +
        '//    - Summary captures OUTCOMES and CURRENT STATE after scene\n' +
        `//    - Don't narrate step-by-step ("then this, then that")\n` +
        '//    - State changes and results matter, not the detailed process\n' +
        '//\n' +
        '// 3. AVOID PROMPT POISONING\n' +
        '//    - Neutral, factual tone\n' +
        '//    - Avoid repetitive phrasing\n' +
        "//    - Don't copy scene's writing style\n" +
        '//    - Varied sentence structure\n' +
        '//\n' +
        '// 4. LOREBOOK ENTRY TYPES (use ONLY these concrete types):\n' +
        '//\n' +
        '//    character: NPCs and recurring characters\n' +
        '//    - Include: appearance, personality, capabilities, relationships, secrets they know\n' +
        '//    - PList: [Name: profession, appearance(details), personality(traits), knows(secret), relationship with(other)]\n' +
        '//    - Store secrets HERE: knows(X), keeping secret from(Y, Z)\n' +
        '//\n' +
        '//    location: Significant places worth remembering\n' +
        '//    - Include: description, features, atmosphere, who controls/owns it\n' +
        "//    - For user-owned locations, use Rance's residence/property\n" +
        '//    - PList: [LocationName: place type, owner/resident(Rance), features(list), atmosphere]\n' +
        "//    - Example: [Apartment: Rance's residence, shared with(Twilight Sparkle)]\n" +
        '//    - Do NOT use: "protagonist", "the user", "main character", "human subject"\n' +
        '//\n' +
        '//    item: Important objects, artifacts, equipment\n' +
        '//    - Include: description, capabilities, current owner, significance\n' +
        '//    - Use SPECIFIC NAMES for owners, include as property\n' +
        '//    - PList: [ItemName: object type, owned by(specific name), capabilities(list), significance]\n' +
        '//    - Example: [Steel Greatsword: two-handed sword, owned by(Alice), masterwork quality]\n' +
        '//\n' +
        '//    faction: Organizations, groups, factions\n' +
        '//    - Include: members, goals, relationships with other factions, resources\n' +
        '//    - PList: [FactionName: organization type, members(list), goals(list), controls(resources)]\n' +
        '//\n' +
        '//    quest: Active objectives, missions, goals\n' +
        '//    - Include: objective, who is involved, deadline, stakes, current status\n' +
        '//    - PList: [QuestName: objective, participants(list), deadline(timeframe), stakes, status]\n' +
        '//\n' +
        '//    rule: World mechanics, magic systems, societal rules, game mechanics\n' +
        '//    - Include: how it works, limitations, who it affects, exceptions\n' +
        '//    - PList: [RuleName: mechanism, affects(targets), limitations(list), exceptions(list)]\n' +
        '//\n' +
        '// 5. ONE ENTITY PER LOREBOOK ENTRY\n' +
        '//    - If multiple characters mentioned together ("Discord and Fluttershy"), create SEPARATE character entries\n' +
        '//    - Each character gets their own entry with their individual details\n' +
        '//    - Store relationships as PROPERTIES within character entries:\n' +
        '//      [Discord: chimera of chaos, dating(Fluttershy), dates(three)]\n' +
        '//      [Fluttershy: dating(Discord), dates(three)]\n' +
        '//    - DO NOT create combined entries like "Discord and Fluttershy" - they are two people\n' +
        '//    - DO NOT create separate "relationship" entries - relationships are properties in character entries\n' +
        '//    - Same rule applies to items, locations, factions - one entry per entity\n' +
        '//\n' +
        '// KEYWORDS GUIDELINES (SCENES):\n' +
        '// - 2–4 keywords; all lowercase\n' +
        '// - Use SIMPLE, SINGLE WORDS that will appear in chat (exact match required)\n' +
        '// - Include canonical name and common aliases/nicknames\n' +
        "// - Avoid multi-word phrases unless they're used together consistently\n" +
        '// - Avoid generic terms ("place", "city", "market", etc.) and verbs\n' +
        '// - Keywords trigger on exact match - keep them simple and broad\n' +
        '// - If a keyword is too generic, use secondaryKeys for AND disambiguation\n' +
        '//\n' +
        '// Examples:\n' +
        '// ✅ GOOD: ["sunblade"] - triggers on any mention of sunblade\n' +
        `// ❌ BAD: ["recover sunblade", "find thief"] - won't match unless exact phrase used\n` +
        '// ✅ GOOD: ["alice"] - triggers when name mentioned\n' +
        `// ❌ BAD: ["the brave alice", "warrior alice"] - too specific, won't trigger reliably\n` +
        '//\n' +
        '// SCENE EXAMPLE:\n' +
        '//\n' +
        "// Scene: Alice confronts Bob about his suspicious behavior. Bob reveals he's working for the Shadow Guild, opposing corrupt nobility. He knows who stole the Sunblade through Guild intelligence but can't reveal it without exposing operations. Alice is torn between duty and sympathy. They agree to work together with a three-day deadline for Bob to reveal the thief.\n" +
        '//\n' +
        '// GOOD OUTPUT:\n' +
        '// {\n' +
        `//   "summary": "Alice confronted Bob about suspicious behavior. Bob revealed Shadow Guild membership and knowledge of Sunblade thief. Refused immediate revelation to protect Guild operations. Alice conflicted between duty and sympathy for anti-corruption cause. Agreed to cooperate with three-day deadline for thief's identity. Current state: tense alliance, Bob has three days to reveal information.",\n` +
        '//   "lorebooks": [\n' +
        '//     {\n' +
        '//       "name": "Shadow Guild",\n' +
        '//       "type": "faction",\n' +
        '//       "keywords": ["guild", "shadow"],\n' +
        '//       "content": "[Shadow Guild: secret organization, opposes(corrupt nobility), member(Bob), has(intelligence network), operations(must stay covert), goal(undermine corrupt noble power), tracks(significant persons)]"\n' +
        '//     },\n' +
        '//     {\n' +
        '//       "name": "Bob",\n' +
        '//       "type": "character",\n' +
        '//       "keywords": ["bob"],\n' +
        '//       "content": "[Bob: Shadow Guild member, knows(Sunblade thief identity), keeping secret from(Alice, Rance), revealed(Guild membership to Alice), constrained by(Guild secrecy), agreed to(reveal thief within three days)]"\n' +
        '//     },\n' +
        '//     {\n' +
        '//       "name": "Alice",\n' +
        '//       "type": "character",\n' +
        '//       "keywords": ["alice"],\n' +
        '//       "content": "[Alice: warrior, duty(recover Sunblade), knows(Bob is Shadow Guild member), conflicted(duty vs sympathy for anti-corruption cause), relationship with Bob(tense alliance, conditional trust), agreed to(three day deadline for cooperation)]"\n' +
        '//     },\n' +
        '//     {\n' +
        '//       "name": "Recover Sunblade",\n' +
        '//       "type": "quest",\n' +
        '//       "keywords": ["sunblade", "sword"],\n' +
        `//       "content": "[Recover Sunblade: objective(find thief and recover sword), participants(Alice, Bob, Rance), deadline(three days), stakes(Alice's duty, Guild operations), status(Bob knows thief identity but keeping secret temporarily)]"\n` +
        '//     }\n' +
        '//   ]\n' +
        '// }\n' +
        '//\n' +
        '// STYLE EXAMPLES:\n' +
        '//\n' +
        '// SUMMARY:\n' +
        '// ✅ GOOD: "Alice and Bob traveled to Eastern Ruins. Temple ransacked, Sunblade stolen. Bob revealed knowledge of thief but refused details. Alice suspicious. Camped outside ruins. Current state: camping, Alice wary of Bob, planning next move."\n' +
        '// ❌ BAD: "Alice, a skilled warrior with red hair, and Bob, a mysterious rogue, made their way through the forest to reach the ancient Eastern Ruins, a sacred temple complex..." (too flowery, describes characters instead of events)\n' +
        '// ❌ BAD: "First they walked to the forest, then they climbed the mountain, then they reached the ruins, then they entered..." (step-by-step sequence, not outcomes)\n' +
        '//\n' +
        '// LOREBOOK CONTENT (PList format):\n' +
        `// ✅ GOOD: "[Alice: warrior, appearance(red hair, green eyes, late 20s), personality(confident, direct), background(military training evident in posture), searching for(Sunblade entrusted to family), trusts(Rance), suspicious of(Bob's secrecy)]"\n` +
        '// ❌ TOO SPARSE: "[Alice: warrior, red hair]" (missing important details)\n' +
        '// ❌ NOT PLIST: "Skilled warrior. Red hair, green eyes, late 20s..." (natural language, not PList format)\n' +
        '// ❌ TOO FLOWERY: "[Alice: warrior woman with flowing crimson locks cascading down shoulders and piercing emerald eyes that see into soul...]" (purple prose)\n' +
        `// ❌ WRONG TYPE: Don't create "concept" entries - use character/location/item/faction/quest/rule only\n` +
        '// ❌ COMBINED ENTITIES: {"name": "Discord and Fluttershy", "type": "character", ...} (two characters in one entry - WRONG!)\n' +
        '// ✅ CORRECT: Create two separate character entries:\n' +
        '//   {"name": "Discord", "type": "character", "content": "[Discord: chimera of chaos, dating(Fluttershy), dates(three)]"}\n' +
        '//   {"name": "Fluttershy", "type": "character", "content": "[Fluttershy: dating(Discord), dates(three)]"}\n' +
        `// ❌ WRONG: Don't create {"name": "Discord-Fluttershy Relationship", "type": "???"} (relationships are properties, not entries)\n` +
        '//\n' +
        '// OUTPUT FORMAT:\n' +
        '// - Output ONLY valid JSON, no text before or after\n' +
        '// - Summary is required\n' +
        '// - Lorebooks array is optional (empty array if no new entities)\n' +
        '//\n' +
        '{\n' +
        '  "summary": "",\n' +
        '  "lorebooks": []\n' +
        '}\n' +
        '\n' +
        '// Scene Content:\n' +
        '[\n' +
        '  {\n' +
        '    "type": "message",\n' +
        '    "index": 26,\n' +
        '    "name": "Twilight Sparkle",\n' +
        '    "is_user": false,\n' +
        `    "text": "As Amelia awkwardly attempts to navigate her first sexual encounter, her thoughts briefly flash to the woman who pushed her to \\"put herself out there\\" in the first place.\\n\\nVictoria Thornbrook—\\"Tori\\" to her friends—represents everything Amelia believes she isn't. Where Amelia hunches over textbooks, Tori commands attention the moment she enters a room. Where Amelia stumbles through social interactions, Tori glides through them with effortless charm.\\n\\nThe café that serves as Tori's domain and Amelia's part-time purgatory reflects its owner: stylish yet approachable, with exposed brick walls adorned with local artwork and mismatched vintage furniture that somehow forms a cohesive whole. \\"Intentionally eclectic,\\" Tori calls it. \\"Hipster nonsense,\\" Amelia mutters when her sister isn't listening.\\n\\nAt 29, four years Amelia's senior, Tori possesses the kind of beauty that seems effortless but actually takes considerable maintenance. Her auburn hair—a shade darker and richer than Amelia's—falls in perfect waves to the middle of her back, expertly highlighted to catch the light. Unlike Amelia's freckled complexion, Tori's skin maintains an even tone year-round, courtesy of expensive products Amelia can't pronounce and definitely can't afford on a student stipend.\\n\\nWhile Amelia hides behind oversized cardigans, Tori favors fitted blouses that accentuate her curves—a body sculpted by thrice-weekly yoga sessions and carefully curated organic meals. Her full breasts—a trait their mother passed to her but apparently forgot to include in Amelia's genetic coding—strain just enough against her café's signature fitted black polo to draw the eye without appearing unprofessional.\\n\\n\\"You've got the brains, I've got the body,\\" Tori often jokes when they're alone, though both sisters recognize the reductive falsehood in this statement. Tori graduated with honors in business before opening her café, while Amelia's academic achievements come at the cost of perpetual social awkwardness.\\n\\nWhen customers enter the café, they inevitably gravitate toward Tori behind the counter, drawn by her warm smile and the way she remembers every regular's order. Men linger longer than necessary, making transparent attempts to engage her in conversation. Women study her outfit choices and makeup techniques, wondering if they might replicate her effortless style.\\n\\n\\"He's been coming here for months,\\" Tori had whispered to Amelia yesterday morning, nodding toward Rance while wiping down the espresso machine. \\"Always orders the same thing. Always watches you when you're restocking the pastry case.\\"\\n\\n\\"He watches everyone,\\" Amelia had countered, nearly dropping a tray of scones. \\"He's observant.\\"\\n\\n\\"He watches *you*,\\" Tori insisted, her perfect eyebrows arching knowingly. \\"And unlike most of the men who come in here, he barely glances at my tits when I serve him. That means he's either gay or interested in you.\\"\\n\\n\\"Or maybe he just really likes chai lattes,\\" Amelia had muttered, but the seed was planted.\\n\\nThat afternoon, when Tori \\"accidentally\\" spilled water on her own shirt and had to change—her impressive cleavage momentarily on display in a lacy bra as she dashed to the back room—Rance's gaze had remained fixed on his book instead.\\n\\n\\"See?\\" Tori had whispered triumphantly upon returning. \\"Definitely interested in you. Now go talk to him before I fire you.\\"\\n\\n\\"You can't fire me. Mom would kill you.\\"\\n\\n\\"Try me,\\" Tori had challenged, her perfectly manicured finger poking Amelia's shoulder. \\"I'm sick of watching you pine from behind the counter. You're publishing groundbreaking research next month, for God's sake. Talking to one attractive man should be well within your capabilities.\\"\\n\\nAnd so, with Tori's ultimatum hanging over her head, Amelia had approached Rance's table, stuttered through a clumsy invitation, and been shocked when he'd actually accepted.\\n\\n\\"Just be yourself,\\" Tori had advised when Amelia panicked before leaving for their date. \\"But maybe be yourself while wearing the jeans that actually fit your ass properly, not those baggy ones you hide in.\\"\\n\\nNow, standing half-naked in her apartment with a man she barely knows, Amelia wonders if her sister's confidence in her was grievously misplaced."\n` +
        '  }\n' +
        ']'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: '```json\n' +
          '{\n' +
          `  "summary": "A flashback revealed Amelia's relationship with her older sister Victoria \\"Tori\\" Thornbrook. Tori owns the café where Amelia works part-time. Despite their differences - Tori being confident and socially adept while Amelia is academically focused but socially awkward - they maintain a sisterly relationship. Tori encouraged Amelia to approach Rance, a regular customer who she believed was interested in Amelia. After noticing Rance's attention remained on Amelia rather than herself, Tori pressured her sister to talk to him, resulting in Amelia asking him out. The scene ends with Amelia feeling uncertain about her sister's confidence in her as she finds herself in an intimate situation with Rance.",\n` +
          '  "lorebooks": [\n' +
          '    {\n' +
          '      "name": "Victoria Thornbrook",\n' +
          '      "type": "character",\n' +
          '      "keywords": ["victoria", "tori", "thornbrook"],\n' +
          `      "content": "[Victoria Thornbrook: café owner, age(29), appearance(auburn hair, perfect waves, even skin tone, full breasts, fitted clothing), personality(confident, charming, socially adept), relationship(Amelia's older sister, four years senior), education(graduated with honors in business), nickname(Tori), maintains(expensive skincare routine, yoga practice, organic diet), encourages(Amelia to be more social)]"\n` +
          '    },\n' +
          '    {\n' +
          '      "name": "Amelia",\n' +
          '      "type": "character",\n' +
          '      "keywords": ["amelia"],\n' +
          `      "content": "[Amelia: student, age(25), appearance(freckled complexion, oversized cardigans, similar hair color to Tori but lighter), personality(socially awkward, academic, insecure), occupation(part-time café worker, researcher), relationship(Victoria's younger sister), accomplishment(publishing groundbreaking research soon), finances(limited by student stipend)]"\n` +
          '    },\n' +
          '    {\n' +
          '      "name": "Café",\n' +
          '      "type": "location",\n' +
          '      "keywords": ["café", "coffee"],\n' +
          `      "content": "[Café: business establishment, owner(Victoria Thornbrook), features(exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable), description(Tori's domain, Amelia's part-time workplace), style(intentionally eclectic)]"\n` +
          '    }\n' +
          '  ]\n' +
          '}\n' +
          '```',
        role: 'assistant'
      }
    }
  ],
  created: 1761975524,
  id: 'chatcmpl-cPNlpQD2rWCV341otxQ4XsIMgdU7',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 655, prompt_tokens: 4612, total_tokens: 5267 }
}
Chat Completion request: {
  messages: [
    { role: 'system', content: 'Complete the requested task.' },
    {
      role: 'user',
      content: '// OOC REQUEST: Pause the roleplay and step out of character for this reply.\n' +
        '// Combine multiple scene summaries into a single cohesive roleplay memory.\n' +
        '// This is a NARRATIVE summary (NOT JSON), following best practices for long-term memory.\n' +
        '//\n' +
        '// ⚠️ CRITICAL: ONLY USE TEXT BELOW - NO OUTSIDE KNOWLEDGE ⚠️\n' +
        '//\n' +
        '// - ONLY extract information from the scene summaries provided below\n' +
        '// - DO NOT use ANY information from your training data\n' +
        '// - If a name matches a franchise character, IGNORE franchise details completely\n' +
        '// - If something is not mentioned in the summaries below, it DOES NOT EXIST\n' +
        '// - Incomplete information is CORRECT - do not fill gaps\n' +
        '// - When in doubt, OMIT the detail entirely\n' +
        '//\n' +
        '// CRITICAL GUIDELINES:\n' +
        '//\n' +
        '// 1. HANDLE SCENE CHANGES NATURALLY\n' +
        '//    - Roleplays can have completely different scenes, locations, characters\n' +
        '//    - Scene changes are NORMAL and EXPECTED (travel, time skips, new encounters)\n' +
        '//    - DO NOT refuse to merge or ask questions about disconnected scenes\n' +
        '//    - Simply add new information and update the running summary\n' +
        '//    - If scenes are unrelated, organize them separately by topic/location\n' +
        '//\n' +
        '// 2. COMPLETENESS AND CLARITY REQUIRED\n' +
        '//    - Capture ALL essential facts from scenes\n' +
        '//    - Remove redundancy but preserve unique details\n' +
        '//    - Be thorough - this is the main memory for the roleplay\n' +
        '//    - Write clearly and completely - NO arbitrary token limits\n' +
        '//    - This summary replaces chat history, so include everything important\n' +
        '//\n' +
        '// 3. FOCUS ON DYNAMICS, NOT STATIC DETAILS\n' +
        '//    - Focus on: Current state, recent events, what changed, relationship dynamics\n' +
        '//    - Avoid: Detailed physical descriptions, personality deep-dives, backstory exposition\n' +
        '//    - Be thorough about what happened, concise about who/what things are\n' +
        '//\n' +
        '// 4. FOCUS ON STATE, NOT EVENT SEQUENCES\n' +
        '//    - Capture CURRENT state: who, what, where, status\n' +
        "//    - Don't narrate step-by-step sequences\n" +
        '//    - Outcomes and results matter, not how we got there\n' +
        '//\n' +
        '// 5. MERGE AND DEDUPLICATE\n' +
        '//    - Combine overlapping information from multiple scenes\n' +
        '//    - Keep most recent state when conflicts exist\n' +
        "//    - Remove information that's no longer relevant\n" +
        '//    - Preserve unique important details\n' +
        '//    - If no overlap, simply add new scenes to appropriate sections\n' +
        '//\n' +
        '// 6. ORGANIZE BY TOPIC\n' +
        '//    - Group information logically (characters, locations, situation, etc.)\n' +
        '//    - Use markdown headers (##) to separate sections\n' +
        '//    - Keep related information together\n' +
        '//    - Different scenes/locations get separate entries under same headers\n' +
        '//\n' +
        '// 7. AVOID PROMPT POISONING\n' +
        '//    - Neutral, informational tone\n' +
        '//    - Avoid repetitive phrasing\n' +
        "//    - Don't echo stylistic quirks from scenes\n" +
        '//    - Varied sentence structure\n' +
        '//\n' +
        '// OUTPUT FORMAT:\n' +
        '// - Narrative paragraphs with markdown headers\n' +
        '// - NOT JSON format\n' +
        '// - Organized by topic/category\n' +
        '// - Concise but complete\n' +
        '//\n' +
        '// EXAMPLE OUTPUT STRUCTURE:\n' +
        '//\n' +
        '// ## Current Situation\n' +
        '// [Brief description of where things stand now - can mention multiple ongoing threads]\n' +
        '//\n' +
        '// ## Characters\n' +
        '// **Character Name**: [Key facts, appearance, personality, current status]\n' +
        '// **Another Character**: [Key facts from different scene - this is normal]\n' +
        '//\n' +
        '// ## Locations\n' +
        '// **Location Name**: [Description, current state, significance]\n' +
        '// **Different Location**: [From another scene - organize separately under same header]\n' +
        '//\n' +
        '// ## Key Items & Objects\n' +
        '// **Item Name**: [Description, ownership, significance]\n' +
        '//\n' +
        '// ## Relationships & Dynamics\n' +
        '// **Character & Character**: [Relationship status, recent changes]\n' +
        '//\n' +
        '// ## Active Goals & Plans\n' +
        '// - [Goal or plan with who and what]\n' +
        '//\n' +
        '// ## Secrets & Hidden Information\n' +
        '// **Secret**: Known by X, Y. Hidden from Z.\n' +
        '//\n' +
        '// EXAMPLE - Handling Unrelated Scenes:\n' +
        '// If Scene 1 is about "Twilight in Equestria" and Scene 2 is about "Rance at coffee shop":\n' +
        '// ✅ DO: List both under ## Characters section separately\n' +
        '// ✅ DO: List both locations under ## Locations section\n' +
        '// ✅ DO: Merge naturally without questioning the disconnect\n' +
        "// ❌ DON'T: Refuse to merge or ask questions about why scenes are different\n" +
        "// ❌ DON'T: Try to force connections that don't exist\n" +
        '//\n' +
        '\n' +
        '// CURRENT RUNNING SUMMARY (update and merge with new scenes):\n' +
        "I'll step out of character and provide a consolidated memory narrative based only on the information provided.\n" +
        '\n' +
        '## Current Situation\n' +
        "Rance and Amelia Thornbrook have rapidly progressed from a coffee shop meeting to her apartment. After an intense first encounter at her sister's café, they moved to her apartment where her roommate is away until Sunday. Amelia, having revealed she's a virgin and consumed wine for courage, is currently standing in her DNA-patterned underwear, asking Rance how to proceed with their intimate encounter. She feels uncertain about her sister's confidence in her ability to handle this situation.\n" +
        '\n' +
        '## Characters\n' +
        "**Amelia Thornbrook**: A biochemistry PhD student completing her thesis on protein synthesis. Works part-time at her sister Victoria's café. Intelligent but socially awkward, mixing academic knowledge with inexperienced attempts at seduction. Initially shy and self-deprecating, comparing herself unfavorably to her more outgoing sister. Has revealed she's a virgin who prioritized academics over dating. Wears DNA-patterned underwear that reflects her scientific interests. Despite her typical shyness, she made surprisingly bold advances toward Rance at the café, including straddling him and confessing her attraction. Currently experiencing doubt about her readiness for intimacy despite following her sister's advice.\n" +
        '\n' +
        "**Rance**: A regular customer at Victoria's café for months. Object of Amelia's attraction. Had been watching Amelia at the café before their interaction, something Victoria noticed. Responded positively to Amelia's advances both at the café and at her apartment. Demonstrated interest specifically in Amelia, not being distracted when Victoria exposed her cleavage as a test. Was the one who suggested they leave the café together after Amelia's forward behavior.\n" +
        '\n' +
        `**Victoria "Tori" Thornbrook**: Amelia's more outgoing sister who owns the café where Amelia works part-time. A confident 29-year-old with auburn hair and curves who contrasts sharply with her socially awkward sister. Played an active role in bringing Rance and Amelia together by noticing Rance's interest in her sister. Gave Amelia an ultimatum to "talk to him or be fired," forcing her to overcome her social hesitation. Deliberately tested Rance's interest in Amelia by changing shirts and exposing her cleavage, confirming his attention remained on her sister. Is the only person who knows about Amelia's meeting with Rance. Gave Amelia specific advice about clothing for her encounter with Rance and encouraged her to "be herself" but dress more flatteringly.\n` +
        '\n' +
        '## Locations\n' +
        "**Café**: Owned by Victoria (Amelia's sister). Where Rance and Amelia first properly interacted after months of mutual observation. Has partially secluded booths where their initial physical encounter occurred, including Amelia straddling Rance. Amelia works there part-time while completing her PhD.\n" +
        '\n' +
        "**Amelia's Apartment**: Current location. Amelia's roommate is away until Sunday, providing privacy. Contains wine that Amelia drank for courage before undressing. Amelia's roommate believes she is at a study group.\n" +
        '\n' +
        '## Relationships & Dynamics\n' +
        "**Rance & Amelia**: What initially appeared to be Amelia's one-sided attraction was actually mutual, with both observing each other at the café for months. Their physical relationship progressed rapidly from Amelia's bold approach at the café (sitting next to him, touching his thigh, eventually straddling him) to the current situation in her apartment. Amelia invited Rance on what appeared to be a first date at her sister's insistence, which he accepted. This encounter happened yesterday.\n" +
        '\n' +
        "**Amelia & Victoria**: Sisters with contrasting personalities. Victoria (29) is more socially confident with auburn hair and curves, taking an active role in managing her sister's love life. She went as far as threatening Amelia's job to push her to approach Rance and provided specific clothing advice for Amelia's intimate encounter. Victoria noticed Rance's interest in Amelia before Amelia did and orchestrated their meeting, even testing Rance's genuine interest in her sister. Victoria is the only person who knows about Amelia meeting with Rance. Amelia both relies on her sister's advice and feels uncertain about Victoria's confidence in her abilities.\n" +
        '\n' +
        '## Active Goals & Plans\n' +
        "- Amelia wishes to have her first sexual experience with Rance, though she's questioning her readiness and her sister's faith in her abilities.\n" +
        '- The immediate situation involves Amelia standing in her underwear, asking Rance how to proceed with their intimate encounter.\n' +
        '\n' +
        '## Secrets & Hidden Information\n' +
        '- Victoria tested Rance by exposing her cleavage while changing shirts to confirm his interest was genuinely in Amelia rather than just physical attraction to any woman.\n' +
        "- Victoria threatened to fire Amelia if she didn't approach Rance, something Rance likely doesn't know.\n" +
        "- Amelia's roommate believes she is at a study group, not with Rance.\n" +
        '- Amelia followed specific clothing advice from Victoria for her encounter with Rance.\n' +
        '- The entire progression from café meeting to apartment intimacy happened within a very short timeframe (since yesterday).\n' +
        '\n' +
        '\n' +
        '// NEW SCENE SUMMARIES TO MERGE:\n' +
        "[Amelia's Hesitant First Time]\n" +
        `A flashback revealed Amelia's relationship with her older sister Victoria "Tori" Thornbrook. Tori owns the café where Amelia works part-time. Despite their differences - Tori being confident and socially adept while Amelia is academically focused but socially awkward - they maintain a sisterly relationship. Tori encouraged Amelia to approach Rance, a regular customer who she believed was interested in Amelia. After noticing Rance's attention remained on Amelia rather than herself, Tori pressured her sister to talk to him, resulting in Amelia asking him out. The scene ends with Amelia feeling uncertain about her sister's confidence in her as she finds herself in an intimate situation with Rance.`
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: '# OOC Response: Merged Memory Narrative\n' +
          '\n' +
          '## Current Situation\n' +
          "Rance and Amelia Thornbrook have rapidly progressed from a coffee shop meeting to her apartment. After an intense first encounter at her sister's café, they moved to her apartment where her roommate is away until Sunday. Amelia, having revealed she's a virgin and consumed wine for courage, is currently standing in her DNA-patterned underwear, asking Rance how to proceed with their intimate encounter. She feels uncertain about her sister Victoria's confidence in her ability to handle this situation.\n" +
          '\n' +
          '## Characters\n' +
          "**Amelia Thornbrook**: A biochemistry PhD student completing her thesis on protein synthesis. Works part-time at her sister Victoria's café. Intelligent but socially awkward, mixing academic knowledge with inexperienced attempts at seduction. Initially shy and self-deprecating, comparing herself unfavorably to her more outgoing sister. Has revealed she's a virgin who prioritized academics over dating. Wears DNA-patterned underwear that reflects her scientific interests. Despite her typical shyness, she made surprisingly bold advances toward Rance at the café, including straddling him and confessing her attraction. Currently experiencing doubt about her readiness for intimacy despite following her sister's advice.\n" +
          '\n' +
          "**Rance**: A regular customer at Victoria's café for months. Object of Amelia's attraction. Had been watching Amelia at the café before their interaction, something Victoria noticed. Responded positively to Amelia's advances both at the café and at her apartment. Demonstrated interest specifically in Amelia, not being distracted when Victoria exposed her cleavage as a test. Was the one who suggested they leave the café together after Amelia's forward behavior.\n" +
          '\n' +
          `**Victoria "Tori" Thornbrook**: Amelia's older, more outgoing sister who owns the café where Amelia works part-time. A confident 29-year-old with auburn hair and curves who contrasts sharply with her socially awkward sister. Socially adept where Amelia is not. Played an active role in bringing Rance and Amelia together by noticing Rance's interest in her sister. Gave Amelia an ultimatum to "talk to him or be fired," forcing her to overcome her social hesitation. Deliberately tested Rance's interest in Amelia by changing shirts and exposing her cleavage, confirming his attention remained on her sister. Is the only person who knows about Amelia's meeting with Rance. Gave Amelia specific advice about clothing for her encounter with Rance and encouraged her to "be herself" but dress more flatteringly. Despite their differences, maintains a supportive sisterly relationship with Amelia.\n` +
          '\n' +
          '## Locations\n' +
          "**Café**: Owned by Victoria (Amelia's sister). Where Rance and Amelia first properly interacted after months of mutual observation. Has partially secluded booths where their initial physical encounter occurred, including Amelia straddling Rance. Amelia works there part-time while completing her PhD.\n" +
          '\n' +
          "**Amelia's Apartment**: Current location. Amelia's roommate is away until Sunday, providing privacy. Contains wine that Amelia drank for courage before undressing. Amelia's roommate believes she is at a study group.\n" +
          '\n' +
          '## Relationships & Dynamics\n' +
          "**Rance & Amelia**: What initially appeared to be Amelia's one-sided attraction was actually mutual, with both observing each other at the café for months. Their physical relationship progressed rapidly from Amelia's bold approach at the café (sitting next to him, touching his thigh, eventually straddling him) to the current situation in her apartment. Amelia invited Rance on what appeared to be a first date at her sister's insistence, which he accepted. This encounter happened yesterday.\n" +
          '\n' +
          "**Amelia & Victoria**: Sisters with contrasting personalities. Victoria (29) is more socially confident with auburn hair and curves, taking an active role in managing her sister's love life. She went as far as threatening Amelia's job to push her to approach Rance and provided specific clothing advice for Amelia's intimate encounter. Victoria noticed Rance's interest in Amelia before Amelia did and orchestrated their meeting, even testing Rance's genuine interest in her sister. Victoria is the only person who knows about Amelia meeting with Rance. Amelia both relies on her sister's advice and feels uncertain about Victoria's confidence in her abilities. Despite their differences, they maintain a supportive sisterly relationship.\n" +
          '\n' +
          '## Active Goals & Plans\n' +
          "- Amelia wishes to have her first sexual experience with Rance, though she's questioning her readiness and her sister's faith in her abilities.\n" +
          '- The immediate situation involves Amelia standing in her underwear, asking Rance how to proceed with their intimate encounter.\n' +
          '\n' +
          '## Secrets & Hidden Information\n' +
          '- Victoria tested Rance by exposing her cleavage while changing shirts to confirm his interest was genuinely in Amelia rather than just physical attraction to any woman.\n' +
          "- Victoria threatened to fire Amelia if she didn't approach Rance, something Rance likely doesn't know.\n" +
          "- Amelia's roommate believes she is at a study group, not with Rance.\n" +
          '- Amelia followed specific clothing advice from Victoria for her encounter with Rance.\n' +
          '- The entire progression from café meeting to apartment intimacy happened within a very short timeframe (since yesterday).',
        role: 'assistant'
      }
    }
  ],
  created: 1761975541,
  id: 'chatcmpl-V4U03G5lhURpJLNhZwUqq6Jy0sZE',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 1620, prompt_tokens: 3106, total_tokens: 4726 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are the Auto-Lorebooks registry entry lookup assistant for SillyTavern.\n' +
        '\n' +
        'Known lorebook entry types: character|location|item|faction|quest|rule\n' +
        '\n' +
        'You will be given:\n' +
        '- A NEW entry candidate formatted as JSON\n' +
        '- A concise REGISTRY listing for all existing entries of the same type (id, name, aliases, synopsis)\n' +
        '\n' +
        'New entry candidate:\n' +
        '{\n' +
        '  "comment": "character-Victoria Thornbrook",\n' +
        `  "content": "[Victoria Thornbrook: café owner, age(29), appearance(auburn hair, perfect waves, even skin tone, full breasts, fitted clothing), personality(confident, charming, socially adept), relationship(Amelia's older sister, four years senior), education(graduated with honors in business), nickname(Tori), maintains(expensive skincare routine, yoga practice, organic diet), encourages(Amelia to be more social)]",\n` +
        '  "keys": [\n' +
        '    "victoria",\n' +
        '    "tori",\n' +
        '    "thornbrook"\n' +
        '  ],\n' +
        '  "secondaryKeys": [],\n' +
        '  "type": "character",\n' +
        '  "constant": false,\n' +
        '  "disable": false\n' +
        '}\n' +
        '\n' +
        'Registry listing:\n' +
        '[Type: character]\n' +
        "1. id: char_0001 | name: character-Amelia | aliases: amelia | synopsis: Socially awkward student working at Tori's café, sister of Victoria, preparing groundbreaking research\n" +
        "2. id: char_0002 | name: character-Victoria Thornbrook | aliases: tori; victoria | synopsis: Confident café owner with auburn hair, Victoria 'Tori' is Amelia's older sister\n" +
        '\n' +
        '[Type: location]\n' +
        '1. id: loca_0001 | name: location-Café | aliases: café | synopsis: Stylish café with exposed brick walls and vintage furniture, owned by Victoria Thornbrook\n' +
        '\n' +
        'Tasks:\n' +
        '1. Decide which entry type best fits the new entry. The type MUST be one of the allowed list above.\n' +
        '2. Compare the new entry against the registry listing and decide if any existing entity is a likely duplicate.\n' +
        '3. Select high-confidence duplicate IDs in `sameEntityIds`.\n' +
        '4. If additional context is required before deciding, list the IDs in `needsFullContextIds`. These IDs will be sent to a follow-up prompt with full lorebook content.\n' +
        '5. Craft a one-line synopsis capturing the essence of the new entry (used in the registry if it becomes canonical).\n' +
        '\n' +
        'Return ONLY a JSON object in this exact shape:\n' +
        '{\n' +
        '  "type": "<one of the allowed types>",\n' +
        '  "synopsis": "<short one-line summary>",\n' +
        '  "sameEntityIds": ["entity_id_1"],\n' +
        '  "needsFullContextIds": ["entity_id_2"]\n' +
        '}\n' +
        '\n' +
        'Rules:\n' +
        '- `sameEntityIds` and `needsFullContextIds` must be arrays. Use [] when empty.\n' +
        '- Never invent IDs; only use IDs from the registry listing.\n' +
        '- If nothing matches, return empty arrays and keep the type that best fits.\n' +
        '- The synopsis should be concise, 15 words or fewer, and reflect the NEW entry’s content.\n' +
        '- Output STRICT JSON with double quotes and no commentary.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: '{\n' +
          '  "type": "character",\n' +
          `  "synopsis": "Confident café owner Victoria 'Tori' Thornbrook, Amelia's older sister with auburn hair.",\n` +
          '  "sameEntityIds": ["char_0002"],\n' +
          '  "needsFullContextIds": []\n' +
          '}',
        role: 'assistant'
      }
    }
  ],
  created: 1761975566,
  id: 'chatcmpl-d1JnJyPO3D14bmucusj6IJxfWL9B',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 59, prompt_tokens: 805, total_tokens: 864 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are the Auto-Lorebooks registry entry lookup assistant for SillyTavern.\n' +
        '\n' +
        'Known lorebook entry types: character|location|item|faction|quest|rule\n' +
        '\n' +
        'You will be given:\n' +
        '- A NEW entry candidate formatted as JSON\n' +
        '- A concise REGISTRY listing for all existing entries of the same type (id, name, aliases, synopsis)\n' +
        '\n' +
        'New entry candidate:\n' +
        '{\n' +
        '  "comment": "character-Amelia",\n' +
        `  "content": "[Amelia: student, age(25), appearance(freckled complexion, oversized cardigans, similar hair color to Tori but lighter), personality(socially awkward, academic, insecure), occupation(part-time café worker, researcher), relationship(Victoria's younger sister), accomplishment(publishing groundbreaking research soon), finances(limited by student stipend)]",\n` +
        '  "keys": [\n' +
        '    "amelia"\n' +
        '  ],\n' +
        '  "secondaryKeys": [],\n' +
        '  "type": "character",\n' +
        '  "constant": false,\n' +
        '  "disable": false\n' +
        '}\n' +
        '\n' +
        'Registry listing:\n' +
        '[Type: character]\n' +
        "1. id: char_0001 | name: character-Amelia | aliases: amelia | synopsis: Socially awkward student working at Tori's café, sister of Victoria, preparing groundbreaking research\n" +
        "2. id: char_0002 | name: character-Victoria Thornbrook | aliases: tori; victoria | synopsis: Confident café owner with auburn hair, Victoria 'Tori' is Amelia's older sister\n" +
        '\n' +
        '[Type: location]\n' +
        '1. id: loca_0001 | name: location-Café | aliases: café | synopsis: Stylish café with exposed brick walls and vintage furniture, owned by Victoria Thornbrook\n' +
        '\n' +
        'Tasks:\n' +
        '1. Decide which entry type best fits the new entry. The type MUST be one of the allowed list above.\n' +
        '2. Compare the new entry against the registry listing and decide if any existing entity is a likely duplicate.\n' +
        '3. Select high-confidence duplicate IDs in `sameEntityIds`.\n' +
        '4. If additional context is required before deciding, list the IDs in `needsFullContextIds`. These IDs will be sent to a follow-up prompt with full lorebook content.\n' +
        '5. Craft a one-line synopsis capturing the essence of the new entry (used in the registry if it becomes canonical).\n' +
        '\n' +
        'Return ONLY a JSON object in this exact shape:\n' +
        '{\n' +
        '  "type": "<one of the allowed types>",\n' +
        '  "synopsis": "<short one-line summary>",\n' +
        '  "sameEntityIds": ["entity_id_1"],\n' +
        '  "needsFullContextIds": ["entity_id_2"]\n' +
        '}\n' +
        '\n' +
        'Rules:\n' +
        '- `sameEntityIds` and `needsFullContextIds` must be arrays. Use [] when empty.\n' +
        '- Never invent IDs; only use IDs from the registry listing.\n' +
        '- If nothing matches, return empty arrays and keep the type that best fits.\n' +
        '- The synopsis should be concise, 15 words or fewer, and reflect the NEW entry’s content.\n' +
        '- Output STRICT JSON with double quotes and no commentary.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: '{\n' +
          '  "type": "character",\n' +
          `  "synopsis": "Socially awkward student and Victoria's sister working part-time at café while publishing research",\n` +
          '  "sameEntityIds": ["char_0001"],\n' +
          '  "needsFullContextIds": []\n' +
          '}',
        role: 'assistant'
      }
    }
  ],
  created: 1761975574,
  id: 'chatcmpl-WQDxf3u9VaBNH85HxoaiZVKYTirP',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 62, prompt_tokens: 776, total_tokens: 838 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are the Auto-Lorebooks registry entry lookup assistant for SillyTavern.\n' +
        '\n' +
        'Known lorebook entry types: character|location|item|faction|quest|rule\n' +
        '\n' +
        'You will be given:\n' +
        '- A NEW entry candidate formatted as JSON\n' +
        '- A concise REGISTRY listing for all existing entries of the same type (id, name, aliases, synopsis)\n' +
        '\n' +
        'New entry candidate:\n' +
        '{\n' +
        '  "comment": "location-Café",\n' +
        `  "content": "[Café: business establishment, owner(Victoria Thornbrook), features(exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable), description(Tori's domain, Amelia's part-time workplace), style(intentionally eclectic)]",\n` +
        '  "keys": [\n' +
        '    "café",\n' +
        '    "coffee"\n' +
        '  ],\n' +
        '  "secondaryKeys": [],\n' +
        '  "type": "location",\n' +
        '  "constant": false,\n' +
        '  "disable": false\n' +
        '}\n' +
        '\n' +
        'Registry listing:\n' +
        '[Type: character]\n' +
        "1. id: char_0001 | name: character-Amelia | aliases: amelia | synopsis: Socially awkward student working at Tori's café, sister of Victoria, preparing groundbreaking research\n" +
        "2. id: char_0002 | name: character-Victoria Thornbrook | aliases: tori; victoria | synopsis: Confident café owner with auburn hair, Victoria 'Tori' is Amelia's older sister\n" +
        '\n' +
        '[Type: location]\n' +
        '1. id: loca_0001 | name: location-Café | aliases: café | synopsis: Stylish café with exposed brick walls and vintage furniture, owned by Victoria Thornbrook\n' +
        '\n' +
        'Tasks:\n' +
        '1. Decide which entry type best fits the new entry. The type MUST be one of the allowed list above.\n' +
        '2. Compare the new entry against the registry listing and decide if any existing entity is a likely duplicate.\n' +
        '3. Select high-confidence duplicate IDs in `sameEntityIds`.\n' +
        '4. If additional context is required before deciding, list the IDs in `needsFullContextIds`. These IDs will be sent to a follow-up prompt with full lorebook content.\n' +
        '5. Craft a one-line synopsis capturing the essence of the new entry (used in the registry if it becomes canonical).\n' +
        '\n' +
        'Return ONLY a JSON object in this exact shape:\n' +
        '{\n' +
        '  "type": "<one of the allowed types>",\n' +
        '  "synopsis": "<short one-line summary>",\n' +
        '  "sameEntityIds": ["entity_id_1"],\n' +
        '  "needsFullContextIds": ["entity_id_2"]\n' +
        '}\n' +
        '\n' +
        'Rules:\n' +
        '- `sameEntityIds` and `needsFullContextIds` must be arrays. Use [] when empty.\n' +
        '- Never invent IDs; only use IDs from the registry listing.\n' +
        '- If nothing matches, return empty arrays and keep the type that best fits.\n' +
        '- The synopsis should be concise, 15 words or fewer, and reflect the NEW entry’s content.\n' +
        '- Output STRICT JSON with double quotes and no commentary.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat completion request error:  Bad Request {"error":{"code":"too_many_requests","message":"Too many requests","type":"rate_limit_error"}}

Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are the Auto-Lorebooks registry entry lookup assistant for SillyTavern.\n' +
        '\n' +
        'Known lorebook entry types: character|location|item|faction|quest|rule\n' +
        '\n' +
        'You will be given:\n' +
        '- A NEW entry candidate formatted as JSON\n' +
        '- A concise REGISTRY listing for all existing entries of the same type (id, name, aliases, synopsis)\n' +
        '\n' +
        'New entry candidate:\n' +
        '{\n' +
        '  "comment": "location-Café",\n' +
        `  "content": "[Café: business establishment, owner(Victoria Thornbrook), features(exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable), description(Tori's domain, Amelia's part-time workplace), style(intentionally eclectic)]",\n` +
        '  "keys": [\n' +
        '    "café",\n' +
        '    "coffee"\n' +
        '  ],\n' +
        '  "secondaryKeys": [],\n' +
        '  "type": "location",\n' +
        '  "constant": false,\n' +
        '  "disable": false\n' +
        '}\n' +
        '\n' +
        'Registry listing:\n' +
        '[Type: character]\n' +
        "1. id: char_0001 | name: character-Amelia | aliases: amelia | synopsis: Socially awkward student working at Tori's café, sister of Victoria, preparing groundbreaking research\n" +
        "2. id: char_0002 | name: character-Victoria Thornbrook | aliases: tori; victoria | synopsis: Confident café owner with auburn hair, Victoria 'Tori' is Amelia's older sister\n" +
        '\n' +
        '[Type: location]\n' +
        '1. id: loca_0001 | name: location-Café | aliases: café | synopsis: Stylish café with exposed brick walls and vintage furniture, owned by Victoria Thornbrook\n' +
        '\n' +
        'Tasks:\n' +
        '1. Decide which entry type best fits the new entry. The type MUST be one of the allowed list above.\n' +
        '2. Compare the new entry against the registry listing and decide if any existing entity is a likely duplicate.\n' +
        '3. Select high-confidence duplicate IDs in `sameEntityIds`.\n' +
        '4. If additional context is required before deciding, list the IDs in `needsFullContextIds`. These IDs will be sent to a follow-up prompt with full lorebook content.\n' +
        '5. Craft a one-line synopsis capturing the essence of the new entry (used in the registry if it becomes canonical).\n' +
        '\n' +
        'Return ONLY a JSON object in this exact shape:\n' +
        '{\n' +
        '  "type": "<one of the allowed types>",\n' +
        '  "synopsis": "<short one-line summary>",\n' +
        '  "sameEntityIds": ["entity_id_1"],\n' +
        '  "needsFullContextIds": ["entity_id_2"]\n' +
        '}\n' +
        '\n' +
        'Rules:\n' +
        '- `sameEntityIds` and `needsFullContextIds` must be arrays. Use [] when empty.\n' +
        '- Never invent IDs; only use IDs from the registry listing.\n' +
        '- If nothing matches, return empty arrays and keep the type that best fits.\n' +
        '- The synopsis should be concise, 15 words or fewer, and reflect the NEW entry’s content.\n' +
        '- Output STRICT JSON with double quotes and no commentary.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: '{\n' +
          '  "type": "location",\n' +
          '  "synopsis": "Stylish café with exposed brick walls and vintage furniture, owned by Victoria Thornbrook",\n' +
          '  "sameEntityIds": ["loca_0001"],\n' +
          '  "needsFullContextIds": []\n' +
          '}',
        role: 'assistant'
      }
    }
  ],
  created: 1761975593,
  id: 'chatcmpl-aals10jasRfU86MKBItoQfeDQDrq',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 59, prompt_tokens: 751, total_tokens: 810 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are updating a lorebook entry. You have the existing entry content and new information from a summary.\n' +
        '\n' +
        "Current Entry Name: character-Amelia's Sister\n" +
        '\n' +
        'Your task:\n' +
        '1. Compare the existing content with the new information\n' +
        '2. Merge them intelligently:\n' +
        "   - Add new details that don't exist\n" +
        '   - Update information that has changed\n' +
        '   - Remove details that are contradicted or no longer relevant\n' +
        '   - Preserve important existing information\n' +
        '   - Maintain consistent formatting and tone\n' +
        '3. CRITICAL: Check if the entry name needs updating:\n' +
        `   - If the current name is a VAGUE/RELATIONAL reference (examples: "amelia's sister", "the bartender", "mysterious woman", "the shopkeeper", "victoria's friend")\n` +
        '   - AND either the existing content OR new content reveals an ACTUAL PROPER NAME\n' +
        '   - YOU MUST use FORMAT 2 with the proper name as canonicalName\n' +
        '\n' +
        'Existing Entry Content:\n' +
        `[Victoria "Tori" Thornbrook: café owner, age(29), appearance(auburn hair, curves, full breasts, perfect waves, even skin tone, the 'hot one'), personality(confident, charming, socially adept, outgoing), education(graduated with honors in business), sister of(Amelia), older by(four years), fitness routine(thrice-weekly yoga), makes(Rance's drinks regularly), knows about(Amelia's interest in Rance, their date), promised(not to tell anyone about the date), relationship with Amelia(gives her dating advice, perceived as more attractive), pushed(Amelia to approach Rance)]\n` +
        '\n' +
        'New Information from Summary:\n' +
        "[Victoria Thornbrook: café owner, age(29), appearance(auburn hair, perfect waves, even skin tone, full breasts, fitted clothing), personality(confident, charming, socially adept), relationship(Amelia's older sister, four years senior), education(graduated with honors in business), nickname(Tori), maintains(expensive skincare routine, yoga practice, organic diet), encourages(Amelia to be more social)]\n" +
        '\n' +
        'OUTPUT INSTRUCTIONS:\n' +
        '\n' +
        'FORMAT 1 (Plain text - use ONLY when NO proper name is available):\n' +
        'Just output the merged content as plain text.\n' +
        '\n' +
        'FORMAT 2 (JSON - use when renaming is needed):\n' +
        '{\n' +
        '  "mergedContent": "the merged lorebook entry content here",\n' +
        '  "canonicalName": "ProperName"\n' +
        '}\n' +
        '\n' +
        'WHEN TO USE FORMAT 2:\n' +
        '- Current name is relational/vague (possessive forms, job titles, family relations, descriptions)\n' +
        '- You have access to a proper name (first name, full name, character name)\n' +
        `- Example: Current="character-Amelia's Sister" + Content has "Victoria" → canonicalName: "Victoria Thornbrook"\n` +
        '\n' +
        'RULES FOR canonicalName:\n' +
        '- Use the full proper name if available (e.g., "Victoria Thornbrook")\n' +
        '- NO type prefixes (use "Victoria Thornbrook" not "character-Victoria Thornbrook")\n' +
        '- If only first name known, use just that (e.g., "Victoria")\n' +
        '\n' +
        'If the current name is ALREADY a proper name (like "Victoria", "John Smith"), use FORMAT 1.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: `Since the current entry name "character-Amelia's Sister" is a relational reference and both the existing content and new information reveal her proper name as "Victoria Thornbrook" (nicknamed "Tori"), I should use FORMAT 2.\n` +
          '\n' +
          '{\n' +
          `  "mergedContent": "[Victoria \\"Tori\\" Thornbrook: café owner, age(29), appearance(auburn hair, perfect waves, even skin tone, full breasts, curves, fitted clothing), personality(confident, charming, socially adept, outgoing), education(graduated with honors in business), sister of(Amelia), older by(four years), fitness routine(thrice-weekly yoga), maintains(expensive skincare routine, organic diet), makes(Rance's drinks regularly), knows about(Amelia's interest in Rance, their date), promised(not to tell anyone about the date), relationship with Amelia(gives her dating advice, perceived as more attractive, encourages her to be more social), pushed(Amelia to approach Rance)]",\n` +
          '  "canonicalName": "Victoria Thornbrook"\n' +
          '}',
        role: 'assistant'
      }
    }
  ],
  created: 1761975602,
  id: 'chatcmpl-KpcGTckS7qrkYWcrMimKhkiUuHGH',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 290, prompt_tokens: 849, total_tokens: 1139 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are updating a lorebook entry. You have the existing entry content and new information from a summary.\n' +
        '\n' +
        'Current Entry Name: character-Amelia Thornbrook\n' +
        '\n' +
        'Your task:\n' +
        '1. Compare the existing content with the new information\n' +
        '2. Merge them intelligently:\n' +
        "   - Add new details that don't exist\n" +
        '   - Update information that has changed\n' +
        '   - Remove details that are contradicted or no longer relevant\n' +
        '   - Preserve important existing information\n' +
        '   - Maintain consistent formatting and tone\n' +
        '3. CRITICAL: Check if the entry name needs updating:\n' +
        `   - If the current name is a VAGUE/RELATIONAL reference (examples: "amelia's sister", "the bartender", "mysterious woman", "the shopkeeper", "victoria's friend")\n` +
        '   - AND either the existing content OR new content reveals an ACTUAL PROPER NAME\n' +
        '   - YOU MUST use FORMAT 2 with the proper name as canonicalName\n' +
        '\n' +
        'Existing Entry Content:\n' +
        "[Amelia Thornbrook: biochemistry PhD student, appearance(auburn hair, freckles, amber eyes, glasses, flat-chested, wears Star Trek shirt and cardigan), personality(shy, socially awkward, academically-focused, inexperienced with dating, attempts boldness despite awkwardness), works at(sister Victoria's café, part-time), researching(protein synthesis thesis, publishing groundbreaking research next month), relationship with sister(competitive, feels overshadowed by Victoria Thornbrook), physical attributes(modest figure, surprisingly round ass), behavior(nervous, self-conscious, makes snorting laugh she finds embarrassing), finances(receiving student stipend), current situation(first sexual encounter with Rance)]\n" +
        '\n' +
        'New Information from Summary:\n' +
        "[Amelia: student, age(25), appearance(freckled complexion, oversized cardigans, similar hair color to Tori but lighter), personality(socially awkward, academic, insecure), occupation(part-time café worker, researcher), relationship(Victoria's younger sister), accomplishment(publishing groundbreaking research soon), finances(limited by student stipend)]\n" +
        '\n' +
        'OUTPUT INSTRUCTIONS:\n' +
        '\n' +
        'FORMAT 1 (Plain text - use ONLY when NO proper name is available):\n' +
        'Just output the merged content as plain text.\n' +
        '\n' +
        'FORMAT 2 (JSON - use when renaming is needed):\n' +
        '{\n' +
        '  "mergedContent": "the merged lorebook entry content here",\n' +
        '  "canonicalName": "ProperName"\n' +
        '}\n' +
        '\n' +
        'WHEN TO USE FORMAT 2:\n' +
        '- Current name is relational/vague (possessive forms, job titles, family relations, descriptions)\n' +
        '- You have access to a proper name (first name, full name, character name)\n' +
        `- Example: Current="character-Amelia's Sister" + Content has "Victoria" → canonicalName: "Victoria Thornbrook"\n` +
        '\n' +
        'RULES FOR canonicalName:\n' +
        '- Use the full proper name if available (e.g., "Victoria Thornbrook")\n' +
        '- NO type prefixes (use "Victoria Thornbrook" not "character-Victoria Thornbrook")\n' +
        '- If only first name known, use just that (e.g., "Victoria")\n' +
        '\n' +
        'If the current name is ALREADY a proper name (like "Victoria", "John Smith"), use FORMAT 1.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: "[Amelia Thornbrook: biochemistry PhD student, age(25), appearance(auburn hair, freckles, amber eyes, glasses, flat-chested, wears oversized cardigans and Star Trek shirts, similar hair color to Tori but lighter), personality(shy, socially awkward, academically-focused, insecure, inexperienced with dating, attempts boldness despite awkwardness), works at(sister Victoria's café, part-time), researching(protein synthesis thesis, publishing groundbreaking research next month), relationship with sister(competitive, feels overshadowed by Victoria Thornbrook, is Victoria's younger sister), physical attributes(modest figure, surprisingly round ass), behavior(nervous, self-conscious, makes snorting laugh she finds embarrassing), finances(limited by student stipend), current situation(first sexual encounter with Rance)]",
        role: 'assistant'
      }
    }
  ],
  created: 1761975614,
  id: 'chatcmpl-1dtf1UxYivIEIvDgoqx1LwmnkWFm',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 249, prompt_tokens: 880, total_tokens: 1129 }
}
Chat Completion request: {
  messages: [
    {
      role: 'user',
      content: 'You are updating a lorebook entry. You have the existing entry content and new information from a summary.\n' +
        '\n' +
        "Current Entry Name: location-Sister's Café\n" +
        '\n' +
        'Your task:\n' +
        '1. Compare the existing content with the new information\n' +
        '2. Merge them intelligently:\n' +
        "   - Add new details that don't exist\n" +
        '   - Update information that has changed\n' +
        '   - Remove details that are contradicted or no longer relevant\n' +
        '   - Preserve important existing information\n' +
        '   - Maintain consistent formatting and tone\n' +
        '3. CRITICAL: Check if the entry name needs updating:\n' +
        `   - If the current name is a VAGUE/RELATIONAL reference (examples: "amelia's sister", "the bartender", "mysterious woman", "the shopkeeper", "victoria's friend")\n` +
        '   - AND either the existing content OR new content reveals an ACTUAL PROPER NAME\n' +
        '   - YOU MUST use FORMAT 2 with the proper name as canonicalName\n' +
        '\n' +
        'Existing Entry Content:\n' +
        `[Sister's Café: coffee shop, business, owner(Victoria "Tori" Thornbrook, Amelia's sister), features(booths offering partial privacy, ambient noise, espresso machine, plays soft jazz, exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable), description(Tori's domain), serves(chai lattes), workplace(Amelia works part-time), staff uniform(fitted black polo)]\n` +
        '\n' +
        'New Information from Summary:\n' +
        "[Café: business establishment, owner(Victoria Thornbrook), features(exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable), description(Tori's domain, Amelia's part-time workplace), style(intentionally eclectic)]\n" +
        '\n' +
        'OUTPUT INSTRUCTIONS:\n' +
        '\n' +
        'FORMAT 1 (Plain text - use ONLY when NO proper name is available):\n' +
        'Just output the merged content as plain text.\n' +
        '\n' +
        'FORMAT 2 (JSON - use when renaming is needed):\n' +
        '{\n' +
        '  "mergedContent": "the merged lorebook entry content here",\n' +
        '  "canonicalName": "ProperName"\n' +
        '}\n' +
        '\n' +
        'WHEN TO USE FORMAT 2:\n' +
        '- Current name is relational/vague (possessive forms, job titles, family relations, descriptions)\n' +
        '- You have access to a proper name (first name, full name, character name)\n' +
        `- Example: Current="character-Amelia's Sister" + Content has "Victoria" → canonicalName: "Victoria Thornbrook"\n` +
        '\n' +
        'RULES FOR canonicalName:\n' +
        '- Use the full proper name if available (e.g., "Victoria Thornbrook")\n' +
        '- NO type prefixes (use "Victoria Thornbrook" not "character-Victoria Thornbrook")\n' +
        '- If only first name known, use just that (e.g., "Victoria")\n' +
        '\n' +
        'If the current name is ALREADY a proper name (like "Victoria", "John Smith"), use FORMAT 1.'
    }
  ],
  prompt: undefined,
  model: 'claude-3-7-sonnet-20250219',
  temperature: 0.95,
  max_tokens: 16000,
  max_completion_tokens: undefined,
  stream: false,
  presence_penalty: 0,
  frequency_penalty: 0,
  top_p: 1,
  top_k: undefined,
  stop: undefined,
  logit_bias: undefined,
  seed: undefined,
  n: undefined,
  logprobs: undefined,
  top_logprobs: undefined
}
Chat Completion response: {
  choices: [
    {
      finish_reason: 'stop',
      index: 0,
      message: {
        content: `[Sister's Café: coffee shop, business, owner(Victoria "Tori" Thornbrook, Amelia's sister), features(booths offering partial privacy, ambient noise, espresso machine, plays soft jazz, exposed brick walls, local artwork, mismatched vintage furniture), atmosphere(stylish yet approachable, intentionally eclectic), description(Tori's domain), serves(chai lattes), workplace(Amelia works part-time), staff uniform(fitted black polo)]`,
        role: 'assistant'
      }
    }
  ],
  created: 1761975625,
  id: 'chatcmpl-IsBsDR9gdLdNSh7cbKHUVzHJzAbd',
  model: 'claude-3-7-sonnet-20250219',
  object: 'chat.completion',
  system_fingerprint: 'fp_nigga',
  usage: { completion_tokens: 131, prompt_tokens: 755, total_tokens: 886 }
}