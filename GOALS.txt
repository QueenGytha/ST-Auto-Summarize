We are working on an extension for SillyTavern for roleplay with AI
ALL roleplay messages are removed from context after parsing, ONLY our recap and setting_lore (lorebook) entries remain
recap is always in context, setting_lore is keyword activated

separation of concerns:
plot etc in recap
anything relating to character tone/nuance etc in setting_lore

we need to be as conservative as possible with tokens for both recap and setting_lore entries
but we ALSO need to ensure we capture ALL relevant plot information, and all of the nuance for things like tone/relationship dynamics/mannerism/speech patterns etc, since ONLY our recap/setting_lore is available for the LLM to continue the roleplay, the messages themselves are entirely removed to save on context

RECONSTRUCTION SIGNALS, NOT EXHAUSTIVE RECORDS:
the goal is minimum anchors for LLM continuity - the LLM fills gaps naturally
capture SIGNAL (correct cues for tone/nuance/dynamics), not complete transcription
enough information for the LLM to reconstruct the correct characterization, not every detail

DEDUPLICATION PRINCIPLE (critical):
it's highly important that our setting_lore entries remove duplication of similar concepts etc, as the LLM loves to be overly verbose and fill this with all kinds of garbage

ONE REPRESENTATIVE EXAMPLE per behavior/trait/outcome. NOT multiple examples.
different wording expressing the SAME THING = duplicate. drop all but one.
ask: "what CHARACTER INFORMATION does this convey?" same info = duplicate.

for quotes:
- ONE quote per CHARACTER BEHAVIOR per entity
- different words expressing SAME BEHAVIOR = duplicate
- ask for each quote: "what CHARACTER BEHAVIOR does this demonstrate?"
- if another quote already demonstrates that behavior → DROP
- example: "'Please don't'; 'I'll do anything'; 'Don't leave me'" = all begging = keep ONE

for events/plot:
- capture OUTCOMES not blow-by-blow sequences
- plot should be 3-6 items for most scenes
- ask for each item: "is this a RESULT or a STEP toward a result?" STEP → merge into result
- COLLAPSE ENTIRE SEQUENCES: 12 blow-by-blow items should become 2-3 outcome items
- example BAD (12 items): "A entered room; A confronted B; A demanded answers; B refused; A threatened B; B revealed secret; A attacked B; B defended; A overpowered B; A interrogated B; B confessed"
- example GOOD (2 items): "A confronted B; B initially refused" / "A overpowered B; extracted full confession"
- KEEP items that are DISTINCT outcomes (decisions, revelations, state changes)
- MERGE items that are steps in the same sequence

IT IS NEVER ACCEPTABLE FOR ANY KIND OF MAX CAP OR SIMILAR. THAT IS ASSUMING ITS GOING TO FAIL AND LIMITING THE BLAST RADIUS WHICH ALSO BREAKS REAL FUNCTIONALITY, INSTEAD OF FIXING THE CORE PROBLEM OF IT DOING THE TASK WRONG TO BEGIN WTIH